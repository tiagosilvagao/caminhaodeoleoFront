function maskDirectiveAsDate(e,t){return maskDirective(e,t,"as-date")}function maskDirectiveMask(e,t){return maskDirective(e,t,"mask")}function maskDirective(e,t,a){return{restrict:"A",require:"?ngModel",link:function(e,r,i,n){if("as-date"!=a||void 0===i.mask){var o=$(r),l=o.attr("type");if("checkbox"!=l&&"password"!=l){o.data("type",l),o.attr("type","text"),n&&(n.$formatters=[],n.$parsers=[]),void 0!==i.asDate&&"text"==l&&(l="date");var s=!1,d=i.mask||i.format;d=d?parseMaskType(d,t):parseMaskType(l,t),d.endsWith(";0")&&(s=!0);var u=d.replace(";1","").replace(";0","").trim();if(void 0!=u&&0!=u.length)if("date"==l||"datetime"==l||"datetime-local"==l||"month"==l||"time"==l||"time-local"==l||"week"==l){var c="date"==l||"datetime"==l||"time"==l;"date"==l?(u=moment.HTML5_FMT.DATE,o.attr("type","date")):"month"==l?(u=moment.HTML5_FMT.MONTH,o.attr("type","month")):"week"==l?(u=moment.HTML5_FMT.WEEK,o.attr("type","week")):"datetime"==l||"datetime-local"==l?(u=moment.HTML5_FMT.DATETIME_LOCAL,o.attr("type","datetime-local")):"time"!=l&&"time-local"!=l||(u=moment.HTML5_FMT.TIME,o.attr("type","time")),n&&(n.$formatters.push(function(e){return e?c?moment.utc(e).format(u):moment(e).format(u):null}),n.$parsers.push(function(e){return e?c?moment.utc(e,u).toDate():moment(e,u).toDate():new Date(e)}))}else if("number"==l||"money"==l||"integer"==l){s=!0,!1;var m=u.trim().replace(/\./g,"").replace(/\,/g,"").replace(/#/g,"").replace(/0/g,"").replace(/9/g,""),p="",v="",f="",g=",",h=0;u.startsWith(m)?p=m:u.endsWith(m)&&(v=m);var M=u.trim().replace(p,"").replace(v,"").trim();M.startsWith("#.")?f=".":M.startsWith("#,")&&(f=",");var y=null;if(-1!=M.indexOf(",0")?(g=",",y=",0"):-1!=M.indexOf(".0")&&(g=".",y=".0"),null!=y){var k=M.substring(M.indexOf(y)+1);h=k.length}var b="numeric";0==h&&(b="integer");var T={rightAlign:"money"==l,unmaskAsNumber:!0,allowMinus:!0,prefix:p,suffix:v,radixPoint:g,digits:h};f&&(T.autoGroup=!0,T.groupSeparator=f),$(r).inputmask(b,T);var D=function(){$(this).data("rawvalue",$(this).inputmask("unmaskedvalue"))};$(r).off("keypress"),e.safeApply(function(){$(r).on("keyup",D)}),n&&(n.$formatters.push(function(e){return void 0!=e&&null!=e&&""!=e?format(u,e):null}),n.$parsers.push(function(e){if(void 0!=e&&null!=e&&""!=e){var t=o.inputmask("unmaskedvalue");if(""!=t)return t}return null}))}else if("text"==l||"tel"==l){var F={};i.maskPlaceholder&&(F.placeholder=i.maskPlaceholder),o.mask(u,F);var D=function(){s&&$(this).data("rawvalue",$(this).cleanVal())};$(r).on("keydown",D).on("keyup",D),s&&n&&(n.$formatters.push(function(e){return e?o.masked(e):null}),n.$parsers.push(function(e){return e?o.cleanVal():null}))}}}}}}function parseMaskType(e,t){return"datetime"==e||"datetime-local"==e?"Format.DateTime"==(e=t.instant("Format.DateTime"))&&(e="DD/MM/YYYY HH:mm:ss"):"date"==e?"Format.Date"==(e=t.instant("Format.Date"))&&(e="DD/MM/YYYY"):"time"==e||"time-local"==e?"Format.Hour"==(e=t.instant("Format.Hour"))&&(e="HH:mm:ss"):"month"==e?e="MMMM":"number"==e?"Format.Decimal"==(e=t.instant("Format.Decimal"))&&(e="0,00"):"money"==e?"Format.Money"==(e=t.instant("Format.Money"))&&(e="#.#00,00"):"integer"==e?e="0":"week"==e?e="dddd":"tel"==e?e="(00) 00000-0000;0":"text"==e&&(e=""),e}maskDirectiveAsDate.$inject=["$compile","$translate"],maskDirectiveMask.$inject=["$compile","$translate"],function($app){var isoDate=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,patternFormat=function(e){return e?$(e).attr("format")||"DD/MM/YYYY":"DD/MM/YYYY"},parsePermission=function(e){var t={visible:{public:!0},enabled:{public:!0}};if(e)for(var a=e.toLowerCase().trim().split(","),r=0;r<a.length;r++){var i=a[r].trim();if(i){var n=i.split(":");if(2==n.length){var o=n[0].trim(),l=n[1].trim();if(l){for(var s=l.split(";"),d={},u=0;u<s.length;u++){var c=s[u].trim();c&&(d[c]=!0)}t[o]=d}}}}return t};app.directive("asDate",maskDirectiveAsDate).directive("ngDestroy",function(){return{restrict:"A",link:function(scope,element,attrs,ctrl){element.on("$destroy",function(){attrs.ngDestroy&&attrs.ngDestroy.length>0&&(attrs.ngDestroy.indexOf("app.")>-1||attrs.ngDestroy.indexOf("blockly.")>-1?scope.$eval(attrs.ngDestroy):eval(attrs.ngDestroy))})}}}).filter("mask",["$translate",function(e){return function(t,a){if(!(a=parseMaskType(a,e)))return t;if(a=a.replace(";1","").replace(";0","").trim(),"string"==typeof t&&t.match(isoDate))return moment.utc(t).format(a);if(t instanceof Date)return moment.utc(t).format(a);if("number"==typeof t)return format(a,t);if(void 0!=t&&null!=t&&""!=t){var r=$('<input type="text">');return r.mask(a),r.masked(t)}return t}}]).directive("mask",maskDirectiveMask).directive("dynamicImage",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,a,r){var i=r.ngRequired&&"true"==r.ngRequired?"required":"",n=a.html(),o='<div ngf-drop="" ngf-drag-over-class="dragover">                   <img style="width: 100%;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">                   <div class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" ngf-pattern="\'image/*\'" ngf-max-size="$maxFileSize$">                     $userHtml$                   </div>                   <div class="remove-image-button button button-assertive" ng-if="$ngModel$" ng-click="$ngModel$=null">                     <span class="icon ion-android-close"></span>                   </div>                   <div class="button button-positive" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">                     <span class="icon ion-ios-videocam"></span>                   </div>                 </div>',l="";r.maxFileSize&&(l=r.maxFileSize),o=$(o.split("$ngModel$").join(r.ngModel).split("$required$").join(i).split("$userHtml$").join(n).split("$maxFileSize$").join(l)),$(a).html(o),e(o)(a.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,a,r){var i=r.ngRequired&&"true"==r.ngRequired?"required":"",n=r.ngModel.split("."),o=n[0],l=n[n.length-1],s=Math.floor(1e3*Math.random()+20),d=a.html(),u="";r.maxFileSize&&(u=r.maxFileSize);var c='                                <div ng-show="!$ngModel$" ngf-drop="" ngf-drag-over-class="dragover">                                  <div class="btn" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" ngf-max-size="$maxFileSize$">                                    $userHtml$                                  </div>                                  <div class="progress" data-type="bootstrapProgress" id="uploadprogress$number$" style="display:none">                                    <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:0%">                                      <span class="sr-only"></span>                                    </div>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="upload-image-component-attribute">                                   <div class="button button-assertive" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="icon ion-android-close"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntityMobile($datasource$,\'$field$\')">download</a>                                   </div>                                 </div>                                 ';c=$(c.split("$ngModel$").join(r.ngModel).split("$datasource$").join(o).split("$field$").join(l).split("$number$").join(s).split("$required$").join(i).split("$userHtml$").join(d).split("$maxFileSize$").join(u)),$(a).html(c),e(c)(a.scope())}}}]).directive("pwCheck",[function(){"use strict";return{require:"ngModel",link:function(e,t,a,r){var i="#"+a.pwCheck;t.add(i).on("keyup",function(){e.$apply(function(){var e=t.val()===$(i).val();r.$setValidity("pwmatch",e)})})}}}]).directive("qr",["$window",function(e){return{restrict:"A",require:"^ngModel",template:'<canvas ng-hide="image"></canvas><img ng-if="image" ng-src="{{canvasImage}}"/>',link:function(t,a,r,i){void 0===t.size&&r.size&&(t.text=r.size);var n=function(){return i.$modelValue||""},o=function(e){return/^[0-9]*$/.test(e)},l=function(e){return/^[0-9A-Z $%*+\-.\/:]*$/.test(e)},s=function(e){for(var t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0},d=function(e,t){if("NUMBER"===e&&!o(t))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===e&&!l(t))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===e&&!s(t))throw new Error("The `8bit` input mode is invalid for text.");if(!s(t))throw new Error("Input mode is invalid for text.");return!0},u=function(e){var a=t.inputMode;return a=a||(o(e)?"NUMBER":void 0),a=a||(l(e)?"ALPHA_NUM":void 0),a=a||(s(e)?"8bit":""),d(a,e)?a:""},c=a.find("canvas")[0],m=!!e.CanvasRenderingContext2D;t.TYPE_NUMBER=function(){return t.typeNumber||0}(),t.TEXT=n(),t.CORRECTION=function(){return{L:1,M:0,Q:3,H:2}[t.correctionLevel||0]||0}(),t.SIZE=function(){return t.size||$(a).outerWidth()}(),t.INPUT_MODE=u(t.TEXT),t.canvasImage="";var p=function(e,t,a,r){for(var i=0;i<a;i++)for(var n=0;n<a;n++){var o=Math.ceil((n+1)*r)-Math.floor(n*r),l=Math.ceil((i+1)*r)-Math.floor(i*r);e.fillStyle=t.isDark(i,n)?"#000":"#fff",e.fillRect(Math.round(n*r),Math.round(i*r),o,l)}},v=function(e,a,r,i,n,o){var l=/^\s+|\s+$/g,s=a.replace(l,""),d=new QRCode(r,i,o);d.addData(s),d.make();var u=e.getContext("2d"),c=d.getModuleCount(),v=n/c;e.width=e.height=n,m&&(p(u,d,c,v),t.canvasImage=e.toDataURL()||"")};t.$watch(function(){return i.$modelValue},function(e,a){e!==a&&(t.text=i.$modelValue,t.TEXT=n(),t.INPUT_MODE=u(t.TEXT),v(c,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE))}),v(c,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE)}}}]).directive("valid",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,a,r){var i={cpf:CPF,cnpj:CNPJ};r.$validators[a.valid]=function(e,r){var n=e||r,o=i[a.valid].isValid(n);return o?t[0].setCustomValidity(""):t.scope().$applyAsync(function(){t[0].setCustomValidity(t[0].dataset.errorMessage)}),o||!n}}}}).directive("cronappSecurity",function(){return{restrict:"A",link:function(e,t,a){var r=[];e.session&&e.session.roles&&(r=e.session.roles.toLowerCase().split(","));for(var i=parsePermission(a.cronappSecurity),n=!1,o=!1,l=0;l<r.length;l++){var s=r[l].trim();s&&(i.visible[s]&&(n=!0),i.enabled[s]&&(o=!0))}n||$(t).hide(),o||$(t).find("*").addBack().attr("disabled",!0)}}}).directive("cronappStars",[function(){"use strict";return{restrict:"A",require:"ngModel",link:function(e,t,a,r){function i(e){for(var t=1;t<=5;t++)l[t-1].removeClass("ion-android-star-outline"),l[t-1].removeClass("ion-android-star"),t<=e?l[t-1].addClass("ion-android-star"):l[t-1].addClass("ion-android-star-outline");return e}var n=$(t),o=$(n.children().get(0));n.html("");for(var l=[],s=1;s<=5;s++){var d=o.clone();n.append(d),d.attr("idx",s),d.click(function(){e.$apply(function(){r.$viewValue=parseInt($(this).attr("idx")),r.$commitViewValue()}.bind(this))}),l.push(d)}r.$parsers.push(i),r.$formatters.push(i)}}}]).directive("cronappFilter",function(){var setFilterInButton=function(e,t,a){var r=e.closest("fieldset");if(r){var i=r.find("button[cronapp-filter]");if(i){var n=i.data("filters");n||(n=[]);var o=-1,l=e.attr("ng-model");if($(n).each(function(e){this.ngModel==l&&(o=e)}),o>-1&&n.splice(o,1),t.length>0){var s={ngModel:l,bindedFilter:t};n.push(s)}i.data("filters",n)}}},makeAutoPostSearch=function(e,t,a){var r=e.closest("fieldset");if(r&&r.length>0){var i=r.find("button[cronapp-filter]");if(i&&i.length>0){var n=i.data("filters");n&&n.length>0&&(t="",$(n).each(function(){t+=this.bindedFilter+";"}))}}a.search(t)},inputBehavior=function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){var filterTemplate="",filtersSplited=attrs.cronappFilter.split(";");$(filtersSplited).each(function(){this.length>0&&(filterTemplate+="text"==typeElement?this+"@"+operator+"%{value}%;":this+operator+"{value};")}),filterTemplate=filterTemplate.length>0?filterTemplate.substr(0,filterTemplate.length-1):"%{value}%",ngModelCtrl?scope.$watch(attrs.ngModel,function(newVal,oldVal){if(!angular.equals(newVal,oldVal)){var eType=$element.data("type")||$element.attr("type"),value=ngModelCtrl.$modelValue,datasource=eval(attrs.crnDatasource);value instanceof Date?(value=value.toISOString(),value+="date"==eType?"@@date":"time"==eType||"time-local"==eType?"@@time":"@@datetime"):"number"==typeof value?value+="@@number":"boolean"==typeof value&&(value+="@@boolean");var bindedFilter=filterTemplate.split("{value}").join(value);0==ngModelCtrl.$viewValue.length&&(bindedFilter=""),setFilterInButton($element,bindedFilter,operator),autopost&&makeAutoPostSearch($element,bindedFilter,datasource)}}):"text"==typeElement?$element.on("keyup",function(){var datasource=eval(attrs.crnDatasource),value=void 0;value=ngModelCtrl&&void 0!=ngModelCtrl?ngModelCtrl.$viewValue:this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==this.value.length&&(bindedFilter=""),setFilterInButton($element,bindedFilter,operator),autopost&&makeAutoPostSearch($element,bindedFilter,datasource)}):$element.on("change",function(){var datasource=eval(attrs.crnDatasource),value=void 0,typeElement=$(this).attr("type");if(void 0!=attrs.asDate&&(typeElement="date"),ngModelCtrl&&void 0!=ngModelCtrl)value=ngModelCtrl.$viewValue;else if("checkbox"==typeElement)value=$(this).is(":checked");else if("date"==typeElement){if(value=this.value,this.value.length>0){var momentDate=moment(this.value,patternFormat(this));value=momentDate.toDate().toISOString()}}else value=this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==value.toString().length&&(bindedFilter=""),setFilterInButton($element,bindedFilter,operator),autopost&&makeAutoPostSearch($element,bindedFilter,datasource)})},buttonBehavior=function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){$element.on("click",function(){var $this=$(this),datasourceName="";datasourceName=attrs.crnDatasource?attrs.crnDatasource:$element.parent().attr("crn-datasource");var filters=$this.data("filters");if(datasourceName&&datasourceName.length>0&&filters){var bindedFilter="";$(filters).each(function(){bindedFilter+=this.bindedFilter+";"});var datasourceToFilter=eval(datasourceName);datasourceToFilter.search(bindedFilter)}})};return{restrict:"A",require:"?ngModel",link:function(e,t,a,r){var i=$(t),n=i.data("type")||i.attr("type");void 0!=a.asDate&&(n="date");var o="=";a.cronappFilterOperator&&a.cronappFilterOperator.length>0&&(o=a.cronappFilterOperator);var l=!0;a.cronappFilterAutopost&&"false"==a.cronappFilterAutopost&&(l=!1),"INPUT"==i[0].tagName?inputBehavior(e,t,a,r,i,n,o,l):buttonBehavior(e,t,a,r,i,n,o,l)}}})}(app);